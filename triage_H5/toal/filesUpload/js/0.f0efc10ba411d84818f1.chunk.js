webpackJsonp([0],{544:function(t,e,i){function s(t){n||i(548)}var n=!1,a=i(42)(i(545),i(547),s,"data-v-bd28ee70",null);a.options.__file="F:\\git\\triage_H5\\src\\page\\filesUpload.vue",a.esModule&&Object.keys(a.esModule).some(function(t){return"default"!==t&&"__"!==t.substr(0,2)}),a.options.functional,t.exports=a.exports},545:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default={data:function(){return{infoList:{fileList:[],idCardNumber:"",gender:"",name:"",photo:"",birthday:"",address:"",race:""},imagtype:0,folderList:{file:null,imgfile:null,upfileInfo:null},show:!1}},watch:{show:function(t,e){var i=this;t&&this.$nextTick(function(){var t=i.$refs.keyboardxx.$el.offsetHeight;i.$refs.fieldUp.style.position="fixed",i.$refs.fieldUp.style.width="100%",i.$refs.fieldUp.style.bottom=t+"px"})}},computed:{},components:{},methods:{afterRead:function(t){var e=this,i=t.file;if(!(i.size<=0)){this.$store.commit("setDataLoading",!0);var s=i.size/1024/1024;if(s>1){var n=1/s||.1,a=new FileReader;a.onload=function(t){var i=t.target.result,s=i.split(";base64,"),a=s[0].split(":")[1],o=new Image;o.src=i,o.onload=function(){var t=document.createElement("canvas"),i=t.getContext("2d"),s=(o.src.length,o.width),r=o.height;t.width=s,t.height=r,i.drawImage(o,0,0,s,r);var l=t.toDataURL(a,n),d=function(t){for(var e=t.split(";base64,"),i=e[0].split(":")[1],s=window.atob(e[1]),n=s.length,a=new Uint8Array(n),o=0;o<n;++o)a[o]=s.charCodeAt(o);return new Blob([a],{type:i})}(l);d&&(e.folderList.file=d,e.imagtype=0,e.upfile())}},a.readAsDataURL(i)}else this.folderList.file=t.file,this.imagtype=0,this.upfile()}},upImage:function(t){var e=this,i=t.target.files[0];if(!(i.size<=0)){this.$store.commit("setDataLoading",!0);var s=i.size/1024/1024;if(s>1){var n=1/s||.1,a=new FileReader;a.readAsDataURL(i),a.onload=function(t){var i=t.target.result,s=i.split(";base64,"),a=s[0].split(":")[1],o=new Image;o.src=i,o.onload=function(){var t=document.createElement("canvas"),i=t.getContext("2d"),s=(o.src.length,o.width),r=o.height;t.width=s,t.height=r,i.drawImage(o,0,0,s,r);var l=t.toDataURL(a,n),d=function(t){for(var e=t.split(";base64,"),i=e[0].split(":")[1],s=window.atob(e[1]),n=s.length,a=new Uint8Array(n),o=0;o<n;++o)a[o]=s.charCodeAt(o);return new Blob([a],{type:i})}(l);d&&(e.folderList.imgfile=d,e.imagtype=1,e.upfile())}}}else this.folderList.imgfile=i,this.imagtype=1,this.upfile()}},upfile:function(){var t=this,e="ajax/web/user/avatar?filename=";1==this.imagtype&&(e="ajax/user/wx/triage/avatar?filename="),this.$http.request({method:"post",url:e+(new Date).getTime()+".png"}).then(function(e){1==e.respStatus&&e.respBody&&(t.folderList.upfileInfo=JSON.parse(e.respBody),t.confirm())})},confirm:function(){var t=this,e={OSSAccessKeyId:this.folderList.upfileInfo.accessid,policy:this.folderList.upfileInfo.policy,signature:this.folderList.upfileInfo.signature,key:this.folderList.upfileInfo.key,success_action_status:"200",file:this.folderList.file};1==this.imagtype&&(e={OSSAccessKeyId:this.folderList.upfileInfo.accessid,policy:this.folderList.upfileInfo.policy,signature:this.folderList.upfileInfo.signature,key:this.folderList.upfileInfo.key,success_action_status:"200",file:this.folderList.imgfile});var i=new FormData;for(var s in e)i.append(s,e[s]);this.$http.request({headers:{"Content-Type":"multipart/form-data","Access-Control-Allow-Origin":"*","Access-Control-Allow-Methods":"POST,OPTIONS","Access-Control-Allow-Headers":"*"},method:"POST",url:this.folderList.upfileInfo.host,data:i}).then(function(e){1==t.imagtype?t.infoList.photo=t.folderList.upfileInfo.avatar_url:t.identification(t.folderList.upfileInfo.avatar_url)})},shuiyingUrl:function(t){this.$http.request({method:"get",url:"/ajax/web/user/idcard/getCardUrl",params:{fileUrl:t}}).then(function(t){})},focus:function(t){document.activeElement.blur(),this.show=!0},onInput:function(t){if(!(this.infoList.idCardNumber.length<18))return void this.$toast("超出身份证位数了!");this.infoList.idCardNumber+=t},onDelete:function(){this.infoList.idCardNumber=this.infoList.idCardNumber.slice(0,this.infoList.idCardNumber.length-1)},blur:function(){this.$refs.fieldUp.style.position="static",this.$refs.fieldUp.style.bottom="",this.show=!1},identification:function(t){var e=this;this.$http.request({method:"get",url:"ajax/web/user/idNumberDiscern",params:{idNumberFrontUrl:t}}).then(function(t){t.success&&t.respBody?(t.respBody.gender="男"==t.respBody.gender?"1":"2",t.respBody.photo="data:image/png;base64,"+(t.respBody.photo?t.respBody.photo:""),Object.assign(e.infoList,t.respBody)):5e3==t.respStatus&&(e.infoList={fileList:[],idCardNumber:"",gender:"",name:"",photo:"",birthday:"",address:"",race:""},e.$Dialog.alert({title:"标题",message:"身份证照片无法识别,请手动输入!"}).then(function(){}))})},submit:function(t){var e=this;return this.infoList.photo?this.infoList.idCardNumber||/^[1-9]\d{5}(18|19|20|(3\d))\d{2}((0[1-9])|(1[0-2]))(([0-2][1-9])|10|20|30|31)\d{3}[0-9Xx]$/.test(this.infoList.idCardNumber)?this.infoList.name?this.infoList.gender?void this.$http.request({method:"post",url:"/ajax/user/wx/triage/addRelationByIdNumber",data:{avatarUrl:this.infoList.photo,idNumber:this.infoList.idCardNumber,name:this.infoList.name,sex:this.infoList.gender}}).then(function(t){6034==t.respStatus?e.$Dialog.alert({title:"您不是管理员 无法操作!"}).then(function(){e.$util.goApp()}):e.$Dialog.alert({title:"添加成功!"}).then(function(){app.addSuccess(0)})}):void this.$toast("请选择性别!"):void this.$toast("请填写姓名!"):void this.$toast("填写合法身份证号码!"):void this.$toast("请上传头像!")}},created:function(){this.$http.request({url:"/ajax/web/report/weeks",method:"get",params:{pageNum:1,pageSize:5}}).then(function(t){})}}},546:function(t,e,i){e=t.exports=i(58)(),e.push([t.i,"\n.field-identity[data-v-bd28ee70]{padding:0 16px\n}\n.field-identity>li[data-v-bd28ee70]{padding:32px 60px 16px 0;color:rgba(69,90,100,0.6);font-weight:normal;font-size:14px;line-height:16px\n}\n.field-identity>li.avatar[data-v-bd28ee70]{position:relative\n}\n.field-identity>li .input-avatar[data-v-bd28ee70]{position:absolute;left:0;top:0;width:26%;height:100%;opacity:0\n}\n.field-identity.identity-sex[data-v-bd28ee70]{display:flex;align-items:center\n}\n.field-identity.identity-sex>li[data-v-bd28ee70]{color:#323233\n}\n.field-identity .head[data-v-bd28ee70]{padding-top:16px;padding-bottom:0\n}\n.field-identity .sex[data-v-bd28ee70]{padding-top:16px\n}\n",""])},547:function(t,e,i){t.exports={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{ref:"fieldUp"},[i("ul",{staticClass:"field-identity context"},[i("li",[t._v("身份证上传")]),t._v(" "),i("van-uploader",{attrs:{multiple:"","after-read":t.afterRead,"max-count":1},model:{value:t.infoList.fileList,callback:function(e){t.$set(t.infoList,"fileList",e)},expression:"infoList.fileList"}}),t._v(" "),i("li",{staticClass:"head"},[t._v("头像")]),t._v(" "),i("li",{staticClass:"avatar"},[i("van-image",{attrs:{round:"",width:"6rem",height:"6rem",fit:"cover",src:t.infoList.photo}}),t._v(" "),i("input",{staticClass:"input-avatar",attrs:{multiple:"multiple",type:"file",accept:"image/*"},on:{change:t.upImage}})],1)],1),t._v(" "),i("van-field",{attrs:{maxlength:"6",type:"text",name:"姓名",label:"姓名",placeholder:"请填写姓名"},model:{value:t.infoList.name,callback:function(e){t.$set(t.infoList,"name",e)},expression:"infoList.name"}}),t._v(" "),i("ul",{staticClass:"field-identity identity-sex"},[i("li",{staticClass:"sex"},[t._v("性别")]),t._v(" "),i("van-radio-group",{attrs:{direction:"horizontal"},model:{value:t.infoList.gender,callback:function(e){t.$set(t.infoList,"gender",e)},expression:"infoList.gender"}},[i("van-radio",{attrs:{name:"1"}},[t._v("男")]),t._v(" "),i("van-radio",{attrs:{name:"2"}},[t._v("女")])],1)],1),t._v(" "),i("van-field",{attrs:{type:"text",name:"身份证",label:"身份证",placeholder:"请填写身份证",maxlength:"18"},on:{focus:t.focus},model:{value:t.infoList.idCardNumber,callback:function(e){t.$set(t.infoList,"idCardNumber",e)},expression:"infoList.idCardNumber"}}),t._v(" "),i("div",{staticStyle:{margin:"36px 16px 16px"}},[i("van-button",{attrs:{round:"",block:"",type:"info"},nativeOn:{click:function(e){return t.submit(e)}}},[t._v("提交")])],1),t._v(" "),i("van-number-keyboard",{ref:"keyboardxx",attrs:{show:t.show,"extra-key":"X","close-button-text":"完成"},on:{blur:t.blur,input:t.onInput,delete:t.onDelete}})],1)},staticRenderFns:[]},t.exports.render._withStripped=!0},548:function(t,e,i){var s=i(546);"string"==typeof s&&(s=[[t.i,s,""]]),s.locals&&(t.exports=s.locals);i(59)("4de6656f",s,!1,{})}});